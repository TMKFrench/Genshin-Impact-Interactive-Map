$(window).load((function(){var mymap,markeropa,catmarkers=[],savearray=[],cordilarray=[],cdeliclarray=[],cpreclarray=[],cluxelarray=[],cdefilarray=[],cfeelarray=[],succeslarray=[],geocularray=[],panolarray=[],sceaugeoarray=[],mondstadtarray=["cordi","cdelic","cprec","cluxe","cdefi","cfee","succes","anemo","pano"],nbtmark=0;function onMapClick(e){console.log(i18n["ui-click"]+mymap.wrapLatLng(e.latlng))}function onMarkerClick(e){markeropa=this}function markeropacity(e){e?markeropa.setOpacity(.45):markeropa.setOpacity(1)}function initarray(){for(var i=0;catmarkers[i];){switch(cookname="chkbox"+catmarkers[i],catmarkers[i]){case"cordil":cordilarray=JSON.parse(localStorage.getItem(cookname));break;case"cdelicl":cdeliclarray=JSON.parse(localStorage.getItem(cookname));break;case"cprecl":cpreclarray=JSON.parse(localStorage.getItem(cookname));break;case"cluxel":cluxelarray=JSON.parse(localStorage.getItem(cookname));break;case"cdefil":cdefilarray=JSON.parse(localStorage.getItem(cookname));break;case"cfeel":cfeelarray=JSON.parse(localStorage.getItem(cookname));break;case"succesl":succeslarray=JSON.parse(localStorage.getItem(cookname));break;case"geocul":geocularray=JSON.parse(localStorage.getItem(cookname));break;case"panol":panolarray=JSON.parse(localStorage.getItem(cookname));break;case"sceaugeo":sceaugeoarray=JSON.parse(localStorage.getItem(cookname))}i++}}function initmarker(markers,cbxname){var cookm=JSON.parse(localStorage.getItem("chkbox"+cbxname)),i=0;if(catmarkers.push(cbxname),cookm)for(;cookm[i];)markeropa=markers[cookm[i]-1],markeropacity(!0),i++}function initmarkerdebug(markers,cbxname){var cookm=JSON.parse(localStorage.getItem("chkbox"+cbxname));console.log(localStorage.getItem("chkbox"+cbxname));var i=0;if(catmarkers.push(cbxname),cookm)for(;cookm[i];)markeropa=markers[cookm[i]-1],console.log("Marker n° "+cookm[i]),markeropacity(!0),i++}function selectarray(mtype,mnumb,mstate){switch(mtype){case"cordil":cookts=gestionarray(cordilarray,mnumb,mstate);break;case"cdelicl":cookts=gestionarray(cdeliclarray,mnumb,mstate);break;case"cprecl":cookts=gestionarray(cpreclarray,mnumb,mstate);break;case"cluxel":cookts=gestionarray(cluxelarray,mnumb,mstate);break;case"cdefil":cookts=gestionarray(cdefilarray,mnumb,mstate);break;case"cfeel":cookts=gestionarray(cfeelarray,mnumb,mstate);break;case"succesl":cookts=gestionarray(succeslarray,mnumb,mstate);break;case"geocul":cookts=gestionarray(geocularray,mnumb,mstate);break;case"panol":cookts=gestionarray(panolarray,mnumb,mstate);break;case"sceaugeo":cookts=gestionarray(sceaugeoarray,mnumb,mstate)}localStorage.setItem("chkbox"+mtype,JSON.stringify(cookts))}function gestionarray(tempcook,chknb,etat){if(etat)tempcook.push(chknb);else for(var i=0;tempcook[i];)tempcook[i]==chknb&&tempcook.splice(i,1),i++;return tempcook}function activecb(mtype,mnumb){var arrayvide=[];if(cooktl=JSON.parse(localStorage.getItem("chkbox"+mtype)),cooktl){for(var i=0;cooktl[i];){if(cooktl[i]==mnumb)return!0;i++}return!1}return localStorage.setItem("chkbox"+mtype,JSON.stringify(arrayvide)),initarray(),!1}function resetmarkers(){doreset(),alert(i18n["ui-reset"]),"fr"==sessionStorage.languagemap?document.location.href="indexl.html":document.location.href="indexlen.html"}function doreset(){for(var i=0,cbx,arraytoreset=catmarkers.concat(mondstadtarray);arraytoreset[i];)cbx="chkbox"+arraytoreset[i],localStorage.removeItem(cbx),i++}function savecookies(){savearray=["v2","cordil",cordilarray,"cdelicl",cdeliclarray,"cprecl",cpreclarray,"cluxel",cluxelarray,"cdefil",cdefilarray,"cfeel",cfeelarray,"succesl",succeslarray,"geocul",geocularray,"panol",panolarray,"sceaugeo",sceaugeoarray];for(var i=0,cbx;mondstadtarray[i];)cbx="chkbox"+mondstadtarray[i],savearray.push(mondstadtarray[i]),localStorage.getItem(cbx)?savearray.push(JSON.parse(localStorage.getItem(cbx))):savearray.push([]),i++;return savearray}function loadcookies(lstmrk){if("v2"==lstmrk[0]){doreset();for(var i=1,cbx;lstmrk[i];)cbx="chkbox"+lstmrk[i],localStorage.setItem(cbx,JSON.stringify(lstmrk[i+1])),i+=2;alert(i18n["ui-import"]),"fr"==sessionStorage.languagemap?document.location.href="indexl.html":document.location.href="indexlen.html"}else alert(i18n["ui-fileerror"])}function reselectmenu(){if($("#activation-select-options li").each((function(){$(this).hasClass("selected")&&$("."+$(this).attr("value")).hide()})),$(".matbtn").each((function(){$(this).hasClass("pressed")&&$("."+$(this).attr("value")).hide()})),localStorage.MenumapgenshinLLi)var listatut=JSON.parse(localStorage.MenumapgenshinLLi);else localStorage.MenumapgenshinLLi=[];if(localStorage.MenumapgenshinLBtn)var btnstatut=JSON.parse(localStorage.MenumapgenshinLBtn);else localStorage.MenumapgenshinLBtn=[];listatut&&listatut.forEach((function(element){$("#li"+element).removeClass("selected"),$("."+element).show()})),btnstatut&&btnstatut.forEach((function(element){$("#btn"+element).removeClass("pressed").attr("src","media/icones/"+element+"on.png"),$("."+element).show()}))}function openMenu(){$("#activation-select-box").addClass("selecting").text(i18n["ui-close"]),$("#activation-select-options").slideDown(150)}lightbox.option({fadeDuration:400,imageFadeDuration:400,maxWidth:1200,maxHeight:900,resizeDuration:400}),$((function(){(mymap=L.map("mapid",{crs:L.CRS.Simple,minZoom:-2,maxZoom:2})).setMaxBounds(new L.latLngBounds([-700,-200],[4469,4047])),mymap.zoomControl.setPosition("topright");var bounds=[[0,0],[3769,3847]],image=L.imageOverlay("media/map-liyue.jpg",bounds).addTo(mymap),markerspano,markerscordi,markerscdelic,markerscprec,markerscluxe,markerscdefi,markerscfee,markersgeocul,markerssceaugeo;function loadmarker(marklist,markico,marktitle,filename,cbxname){var listback=[],marq=[],nfichier,i,mtype;for(i=0;i<marklist.length;i++)switch(nfichier=filename+(i+1),mtype=(marq=marklist[i])[0]){case 0:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).bindPopup(`<a href="media/${nfichier}.jpg" data-lightbox="${nfichier}" data-title="${marktitle}"><img class="thumb" src="media/${nfichier}.jpg"/></a>`,popupOptions);break;case 1:listback.push(L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<a href="media/${nfichier}.jpg" data-lightbox="${nfichier}" data-title="${marktitle}"><img class="thumb" src="media/${nfichier}.jpg"/></a><br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2>`,popupOptions));break;case 2:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).bindPopup(`<h1><a href="media/${nfichier}.jpg" data-lightbox="${nfichier}" data-title="${marktitle}"><img class="thumb" src="media/${nfichier}.jpg"/></a><br><br>${marq[2]}</h1>`,popupOptions);break;case 3:listback.push(L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<h1><a href="media/${nfichier}.jpg" data-lightbox="${nfichier}" data-title="${marktitle}"><img class="thumb" src="media/${nfichier}.jpg"/></a><br><br>${marq[2]}<br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2>`,popupOptions));break;case 4:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).bindPopup(`<iframe width="560" height="315" src="//www.youtube.com/embed/${marq[2]}?rel=0" frameborder="0" allowfullscreen></iframe>`,popupOptions);break;case 5:listback.push(L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<iframe width="560" height="315" src="//www.youtube.com/embed/${marq[2]}?rel=0" frameborder="0" allowfullscreen></iframe><br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2>`,popupOptions));break;case 6:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).bindPopup(`<iframe width="560" height="315" src="//www.youtube.com/embed/${marq[2]}?rel=0" frameborder="0" allowfullscreen></iframe><br><h1>${marq[3]}</h1>`,popupOptions);break;case 7:listback.push(L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<iframe width="560" height="315" src="//www.youtube.com/embed/${marq[2]}?rel=0" frameborder="0" allowfullscreen></iframe><br><h1>${marq[3]}<br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2></h1>`,popupOptions));break;case 8:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).bindPopup(`<h1>${marq[2]}</h1>`,popupOptions);break;case 9:listback.push(L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<h1>${marq[2]}<br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2></h1>`,popupOptions));break;case 10:L.marker(marq[1],{icon:Null,title:""}).addTo(mymap).bindPopup(`<h1>${marq[2]}</h1>`,popupOptions);break;case 11:listback.push(L.marker(marq[1],{icon:Null,title:""}).addTo(mymap).on("click",onMarkerClick).bindPopup(`<h1>${marq[2]}<br><h2><input id="mapbox" name="${cbxname}" value="${i+1}" type="checkbox" /> Trouvé</h2></h1>`,popupOptions));break;case 12:L.marker(marq[1],{icon:markico,title:marktitle}).addTo(mymap)}return console.log(marktitle+" : "+marklist.length+i18n["ui-load"]),nbtmark+=marklist.length,listback}mymap.fitBounds(bounds),loadmarker(liststatue,Statue,i18n.cat01,"statuel",""),loadmarker(listteleport,Teleport,i18n.cat02,"tpl",""),initmarker(loadmarker(listpano,Pano,i18n.cat03,"panol","panol"),"panol"),initmarker(loadmarker(listcordi,Cordi,i18n.cat04,"ocl","cordil"),"cordil"),initmarker(loadmarker(listcdelic,Cdelic,i18n.cat05,"dcl","cdelicl"),"cdelicl"),initmarker(loadmarker(listcprec,Cprec,i18n.cat06,"pcl","cprecl"),"cprecl"),initmarker(loadmarker(listcluxe,Cluxe,i18n.cat07,"lcl","cluxel"),"cluxel"),initmarker(loadmarker(listcdefi,Cdefi,i18n.cat08,"defil","cdefil"),"cdefil"),initmarker(loadmarker(listcfee,Cfee,i18n.cat09,"","cfeel"),"cfeel"),initmarker(loadmarker(listgeocul,Geocul,i18n.cat29,"geoc","geocul"),"geocul"),initmarker(loadmarker(listsceaugeo,Sceaugeo,i18n.cat30,"sg","sceaugeo"),"sceaugeo"),loadmarker(listcristal,Cristal,i18n.cat11,"",""),loadmarker(listelectroc,Electrocris,i18n.cat12,"",""),loadmarker(listfbrume,Fbrume,i18n.cat13,"",""),loadmarker(listffeu,Ffeu,i18n.cat14,"",""),loadmarker(listbambou,Bambou,i18n.cat31,"",""),loadmarker(listperle,Perle,i18n.cat32,"",""),loadmarker(listlotus,Lotus,i18n.cat33,"",""),loadmarker(listpomme,Pomme,i18n.cat15,"",""),loadmarker(listcarotte,Carotte,i18n.cat16,"",""),loadmarker(listradis,Radis,i18n.cat17,"",""),loadmarker(listqingxin,Qingxin,i18n.cat34,"",""),loadmarker(listmuguet,Muguet,i18n.cat35,"muguet",""),loadmarker(listpiment,Piment,i18n.cat36,"",""),loadmarker(listlysverni,Lysverni,i18n.cat37,"",""),loadmarker(listfsoie,Fsoie,i18n.cat38,"",""),loadmarker(listjade,Jade,i18n.cat39,"",""),loadmarker(listconque,Conque,i18n.cat40,"",""),loadmarker(listlapis,Lapis,i18n.cat41,"",""),loadmarker(listferblanc,Ferblanc,i18n.cat25,"",""),loadmarker(listgrenouille,Grenouille,i18n.cat27,"",""),loadmarker(listlezard,Lezard,i18n.cat28,"",""),loadmarker(listpapillon,Papillon,i18n.cat42,"",""),loadmarker(listluciole,Luciole,i18n.cat43,"",""),loadmarker(listnoyauc,Noyauc,i18n.cat44,"","");var markerssucces=[L.marker([3146,1800],{icon:Succes,title:i18n["succesl-01-title"]}).addTo(mymap).on("click",onMarkerClick).bindPopup('<iframe width="560" height="315" src="//www.youtube.com/embed/lVXYQI-l2F4?rel=0" frameborder="0" allowfullscreen></iframe><br><h1>'+i18n["succesl-01-h1"]+'<br><h2><input id="mapbox" name="succesl" value="1" type="checkbox" /> '+i18n["ui-found"]+"</h2></h1>",popupOptions),L.marker([1991,2829],{icon:Succes,title:i18n["succesl-02-title"]}).addTo(mymap).on("click",onMarkerClick).bindPopup('<iframe width="560" height="315" src="//www.youtube.com/embed/SO7HtQ2JJP0?rel=0" frameborder="0" allowfullscreen></iframe><br><h1>'+i18n["succesl-02-h1"]+'<br><h2><input id="mapbox" name="succesl" value="2" type="checkbox" /> '+i18n["ui-found"]+"</h2></h1>",popupOptions)];initmarker(markerssucces,"succesl"),nbtmark+=markerssucces.length,console.log(i18n["ui-succes"]+markerssucces.length+i18n["ui-load"]),localStorage.nbtliyue=nbtmark,mymap.on("click",onMapClick),mymap.on("popupopen",(function(){if($(":checkbox").on("change",(function(){var checkboxtype=this.name,checkboxnumber=this.value,checkboxstate=this.checked;selectarray(checkboxtype,checkboxnumber,checkboxstate),markeropacity(checkboxstate)})),document.getElementById("mapbox")){var checkboxtype,checkboxnumber,checkboxstate=activecb(document.getElementById("mapbox").name,document.getElementById("mapbox").value);$("#mapbox").prop("checked",checkboxstate)}})),$("#activation-select-box").on("click",(function(){$(this).hasClass("selecting")?($(this).removeClass("selecting").text(i18n["ui-open"]),$("#activation-select-options").slideUp(150)):($(this).addClass("selecting").text(i18n["ui-close"]),$("#activation-select-options").slideDown(150))})),$("#activation-select-options li").on("click",(function(){var val=$(this).attr("value");$(this).toggleClass("selected"),$("."+val).toggle();var listatut=[];$("#activation-select-options li").each((function(){$(this).hasClass("section")||$(this).hasClass("selected")||$(this).hasClass("selectbtn")||listatut.push($(this).attr("value"))})),localStorage.MenumapgenshinLLi=JSON.stringify(listatut)})),$(".matbtn").on("click",(function(){var ndf=$(this).attr("value");$(this).hasClass("pressed")?($(this).attr("src","media/icones/"+ndf+"on.png"),$(this).toggleClass("pressed")):($(this).attr("src","media/icones/"+ndf+"off.png"),$(this).toggleClass("pressed")),$("."+ndf).toggle();var btnstatut=[];$(".matbtn").each((function(){$(this).hasClass("pressed")||btnstatut.push($(this).attr("value"))})),localStorage.MenumapgenshinLBtn=JSON.stringify(btnstatut)})),$("#BtnReset").on("click",(function(){confirm(i18n["ui-prereset"])&&resetmarkers()})),$("#BtnEnglish").on("click",(function(){document.location.href="indexlen.html"})),$("#BtnFrench").on("click",(function(){document.location.href="indexl.html"})),$("#BtnExport").on("click",(function(){this.href=URL.createObjectURL(new Blob([JSON.stringify(savecookies())])),alert(i18n["ui-export"])})),$("#BtnImport").on("click",(function(e){var fileElem=document.getElementById("ImportBox");fileElem&&fileElem.click(),e.preventDefault()})),$("#ImportBox").on("change",(function(ev_){var fr_;(fr_=new FileReader).onload=function(ev_){loadcookies(JSON.parse(this.result))},fr_.readAsText(this.files[0])})),$("#btnmap").on("click",(function(){"fr"==sessionStorage.languagemap?document.location.href="indexfr.html":document.location.href="index.html"}))})),initarray(),reselectmenu(),openMenu()}));